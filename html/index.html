<!DOCTYPE html>
<html>

  <head>
    <meta charset="UTF-8">
    <title>SourceForm</title>
    <!-- Load special keybinding settings -->
    <script src="../utils/keybindings.js"></script>
    <!-- Load special searchfield textbox handlings -->
    <script src="../utils/searchfieldHandler.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/disable-text-selection.css">
    <!-- Load onscreen keyboard -->
    <script>
      var jQuery = $ = require('jquery');
      require('electron-virtual-keyboard/client')(window, jQuery);
    </script>
    <!-- Load stylesheet for onscreen keyboard -->
    <link href="../css/virtual-keyboard-mod.css" type="text/css" rel="stylesheet" />
  </head>

  <body>
    <h1>SourceForm</h1>
    We are using node <script>document.write(process.versions.node)</script>,
    Chrome <script>document.write(process.versions.chrome)</script>,
    and Electron <script>document.write(process.versions.electron)</script>.
    <button onclick="const remote = require('electron').remote; let w = remote.getCurrentWindow(); w.close();">Quit</button>
    <input type="text" id="searchfield" value="find an object to print..." onclick="checkSearchFieldOnClick()" onblur="checkSearchFieldOnBlur()" />
    <script>
      // Define a key to hide the keyboard
      $.fn.keyboard_custom_keys['^hidekey$'] = {
        render: function(kb, $key, modifier) {
          $key.text('hide');
        },
        handler: function(kb, $key) {
          kb.hide();
          document.getElementById('searchfield').blur()
        }
      }
      // Define the left arrow key (move caret one character to the left)
      $.fn.keyboard_custom_keys['^leftarrow$'] = {
        render: function(kb, $key, modifier) {
          $key.text('←');
        },
        handler: function(kb, $key) {
          var box = document.getElementById('searchfield')
          var caret = box.selectionStart
          box.setSelectionRange(caret - 1, caret - 1)
        }
      }
      // Define the right arrow key (move caret one character to the right)
      $.fn.keyboard_custom_keys['^rightarrow$'] = {
        render: function(kb, $key, modifier) {
          $key.text('→');
        },
        handler: function(kb, $key) {
          var box = document.getElementById('searchfield')
          var caret = box.selectionStart
          box.setSelectionRange(caret + 1, caret + 1)
        }
      }
      // Load keyboard
      var keyboard = $('input:text').keyboard({
        layout: {
          'normal': [
            '1 2 3 4 5 6 7 8 9 0 {backspace}',
            ['q w e r t y u i o p {sp:1}'],
            ['{sp:2} a s d f g h j k l \' {enter}'],
            ['{shift} {sp:1} z x c v b n m . {sp:2}'],
            ['{hidekey} {sp:1} {space} {sp:1} {leftarrow} {rightarrow}']
          ],
          'shift': [
            '1 2 3 4 5 6 7 8 9 0  {backspace}',
            ['Q W E R T Y U I O P {sp:1}'],
            ['{sp:2} A S D F G H J K L " {enter}'],
            ['{shift} {sp:1} Z X C V B N M ? {sp:2}'],
            ['{hidekey} {sp:1} {space} {sp:1} {leftarrow} {rightarrow}']
          ]
        }
      });

      // Hide virtual keyboard if user clicked outside of its container
      $(document).click(function(event) {
        $target = $(event.target);
        if (!$target.is("input#searchfield") &&
          !$target.closest('.virtual-keyboard').length &&
          $('.virtual-keyboard').is(":visible")) {
          $('.virtual-keyboard').hide();
        }
      });
    </script>
  </body>

</html>